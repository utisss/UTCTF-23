# Affinity

Most people that study cryptography simply see the SBOX as a basic substitution box, but the SBOX is actually one of the most important components of the AES encryption algorithm. The SBOX is carefully chosen to ensure that AES is nonlinear, as linear equations can trivially be solved using linear algebra. For this problem, I modified the SBOX to be a one to one mapping. That said, affine function (hence the name) would have sufficed. In this case, we perform a known plaintext attack to recover a bitstring that will encrypt and decrypt. Think about it this way, when the SBOX is linear, the entirity of AES can be represented as the multiplication of matrices. If the set of keys are unknown matrices, we just have to create enough ciphertext to plaintext equations to solve this system of linear equations. For AES 128, there is a somewhat cooler shortcut method to solve for an equivalent key. This bitstring does not (and likely will not) be the original encryption key, but can map plaintexts to corresponding ciphertexts and vise versa. Hence, we call this the equivalent key. A forward encryption of \x00's results in the equivalent key which can then be XOR'd with the ciphertext. This result is run through the AES decryption algorithm without the round key step to recover the plaintext. Why this works is explained in this stack overflow post: [https://crypto.stackexchange.com/questions/67612/aes-oracle-with-bad-s-box](https://crypto.stackexchange.com/questions/67612/aes-oracle-with-bad-s-box)
